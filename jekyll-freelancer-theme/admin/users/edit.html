---
layout: admin
---
<div class="row">
  <div class="col-lg-12 text-center">
    <h2>Edit User</h2>
    <hr class="star-primary">
  </div>
</div>
<div class="row">
  <div class="col-lg-8 col-lg-offset-2">
    <form id="editUserForm">
      <div class="form-group">
        <label for="email">Email Address</label>
        <input type="email" class="form-control" id="email" placeholder="Email">
      </div>
      <div class="form-group">
        <label for="name">Name</label>
        <input type="text" class="form-control" id="name" placeholder="Name">
      </div>
      <div class="form-group">
        <label for="location">Location</label>
        <input type="text" class="form-control" id="location" placeholder="Location">
      </div>
      <div class="checkbox">
        <label>
          <input type="checkbox" id="is_admin"> Is Admin
        </label>
      </div>
      <button type="submit" class="btn btn-success">Save Changes</button>
    </form>
    <div id="success-message" style="margin-top: 20px;"></div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    var token = localStorage.getItem("su_token");
    var urlParams = new URLSearchParams(window.location.search);
    var userId = urlParams.get('id');
    var form = document.getElementById('editUserForm');
    var successMessage = document.getElementById('success-message');

    if (!userId) {
        successMessage.innerHTML = '<div class="alert alert-danger">No user ID provided.</div>';
        return;
    }

    // Fetch user data and populate the form
    fetch(`http://localhost:8000/api/v1/admin/users/${userId}`, {
        headers: { "Authorization": "Bearer " + token }
    })
    .then(response => response.json())
    .then(user => {
        if (user.detail) throw new Error(user.detail);
        document.getElementById('email').value = user.email;
        document.getElementById('name').value = user.name;
        document.getElementById('location').value = user.location;
        document.getElementById('is_admin').checked = user.is_admin;
    })
    .catch(error => {
        successMessage.innerHTML = `<div class="alert alert-danger">Error fetching user data: ${error.message}</div>`;
    });

    // Handle form submission
    form.addEventListener('submit', function(event) {
        event.preventDefault();

        var updatedData = {
            email: document.getElementById('email').value,
            name: document.getElementById('name').value,
            location: document.getElementById('location').value,
            is_admin: document.getElementById('is_admin').checked
        };

        fetch(`http://localhost:8000/api/v1/admin/users/${userId}`, {
            method: 'PUT',
            headers: {
                'Authorization': 'Bearer ' + token,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(updatedData)
        })
        .then(response => {
            if (response.ok) {
                return response.json();
            } else {
                return response.json().then(errorData => {
                    throw new Error(errorData.detail || 'Failed to update user.');
                });
            }
        })
        .then(data => {
            successMessage.innerHTML = '<div class="alert alert-success">User updated successfully! Redirecting...</div>';
            setTimeout(() => {
                window.location.href = '{{ site.baseurl }}/admin/users.html';
            }, 2000);
        })
        .catch(error => {
            successMessage.innerHTML = `<div class="alert alert-danger">Error updating user: ${error.message}</div>`;
        });
    });
});
</script>
