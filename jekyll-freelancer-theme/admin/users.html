---
layout: admin
lang: ca
---
<div class="row">
  <div class="col-lg-12 text-center">
    <h2>{{ site.data[page.lang].admin.users_title }}</h2>
    <hr class="star-primary">
  </div>
</div>
<div class="row">
  <div class="col-lg-12" id="user-list-container">
    <table class="table table-striped">
      <thead>
        <tr>
          <th>{{ site.data[page.lang].admin.col_email }}</th>
          <th>{{ site.data[page.lang].admin.col_is_admin }}</th>
          <th>{{ site.data[page.lang].admin.col_is_superuser }}</th>
          <th>{{ site.data[page.lang].admin.col_actions }}</th>
        </tr>
      </thead>
      <tbody id="user-table-body">
        <tr><td colspan="4">{{ site.data[page.lang].admin.loading_users }}</td></tr>
      </tbody>
    </table>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    var token = localStorage.getItem("su_token");
    var tableBody = document.getElementById("user-table-body");

    if (!token) {
        tableBody.innerHTML = '<tr><td colspan="4">You are not authorized to view this page.</td></tr>';
        return;
    }

    fetch("http://localhost:8000/api/v1/admin/users", {
        headers: {
            "Authorization": "Bearer " + token
        }
    })
    .then(function(response) {
        if (response.ok) {
            return response.json();
        } else {
            throw new Error("Failed to fetch users.");
        }
    })
    .then(function(users) {
        var noUsersText = {{ site.data[page.lang].admin.no_users_found | jsonify }};
        if (users.length === 0) {
            tableBody.innerHTML = `<tr><td colspan="4">${noUsersText}</td></tr>`;
            return;
        }

        tableBody.innerHTML = '';
        var editText = {{ site.data[page.lang].admin.edit_button | jsonify }};
        var deleteText = {{ site.data[page.lang].admin.delete_button | jsonify }};
        var siteEmail = {{ site.email | jsonify }};

        users.forEach(function(user) {
            var row = document.createElement('tr');
            // The backend User model doesn't have is_superuser, so we'll fake it for now.
            // This will be properly addressed when we build the edit/create logic.
            var isSuperuser = user.email === siteEmail; // Placeholder logic
            row.innerHTML = `
                <td>${user.email}</td>
                <td>${user.is_admin}</td>
                <td>${isSuperuser}</td>
                <td>
                    <a href="users/edit.html?id=${user.id}" class="btn btn-sm btn-primary">${editText}</a>
                    <button class="btn btn-sm btn-danger">${deleteText}</button>
                </td>
            `;
            tableBody.appendChild(row);
        });
    })
    .catch(function(error) {
        console.error("Error fetching users:", error);
        tableBody.innerHTML = `<tr><td colspan="4">Error loading users: ${error.message}</td></tr>`;
    });
});
</script>
