{% assign current_lang = page.lang | default: "ca" %}

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>{{ site.title }}</title>
  <meta name="viewport" content="width=device-width">
  <meta name="description" content="{{ site.description }}">
  <meta name="keywords" content="{{ site.keywords }}" />
  
  <link rel="canonical" href="{{ site.url }}{{ page.url | replace:'index.html','' }}">
  <link rel="alternate" type="application/rss+xml" title="RSS" href="{{ site.baseurl }}/feed.xml">

    <!-- Define the favicon -->
  <link rel="icon" type="image/x-icon" href="{{ site.baseurl }}/img/favicon.ico">
  <!-- Optionally, include the shortcut icon for older browsers -->
  <link rel="shortcut icon" href="{{ site.baseurl }}/img/favicon.ico" type="image/x-icon">

  <!-- ✅ Corrected CSS Paths -->
  <link rel="stylesheet" href="{{ site.baseurl }}/style.css">
  <link rel="stylesheet" href="{{ site.baseurl }}/css/font-awesome/css/all.min.css">
  
  <!-- ✅ Corrected Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">

  <script>
  document.addEventListener("DOMContentLoaded", function () {
    // Check if a language preference is already set in the URL
    let currentPath = window.location.pathname;
    let languageSet = currentPath.startsWith("/ca") || currentPath.startsWith("/es") || currentPath.startsWith("/en") || currentPath.startsWith("/admin") || currentPath.startsWith("/su");

    if (!languageSet) {
      // Detect browser language
      let userLang = navigator.language || navigator.userLanguage;
      userLang = userLang.toLowerCase(); // Normalize the language code

      // Define language redirection rules
      let langRedirect;
      if (userLang.startsWith("ca")) {
        langRedirect = "/ca/";
      } else if (userLang.startsWith("es")) {
        langRedirect = "/es/";
      } else {
        langRedirect = "/en/";
      }

      // Redirect if not already on a language-specific page
      window.location.replace(langRedirect);
    }
  });
  </script>

  <script>
    // Consolidated Superuser & Page Protection Script
    (function() {
        var su_token = localStorage.getItem('su_token');
        var isAdminPage = window.location.pathname.startsWith('/admin');
        var loginUrl = '{{ site.baseurl }}/su/su.html';

        if (su_token) {
            fetch('http://localhost:8000/api/v1/su/ping', {
                headers: { 'Authorization': 'Bearer ' + su_token }
            })
            .then(function(res) {
                if (res.ok) {
                    // Superuser is logged in and token is valid.
                    document.addEventListener('DOMContentLoaded', function() {
                        // Show admin-related links
                        var adminLink = document.getElementById('admin-nav-link');
                        if (adminLink) adminLink.style.display = 'block';

                        var suLogoutLink = document.getElementById('su-logout-link');
                        if (suLogoutLink) {
                            suLogoutLink.style.display = 'block';
                            suLogoutLink.addEventListener('click', function(e) {
                                e.preventDefault();
                                localStorage.removeItem('su_token');
                                window.location.href = '{{ site.baseurl }}/';
                            });
                        }

                        // Hide regular user links
                        var loginLink = document.getElementById('login-link');
                        if (loginLink) loginLink.style.display = 'none';
                        var registerLink = document.getElementById('register-link');
                        if (registerLink) registerLink.style.display = 'none';
                        var userLink = document.getElementById('user-link');
                        if (userLink) userLink.style.display = 'none';
                    });
                } else {
                    // Token is invalid, remove it
                    localStorage.removeItem('su_token');
                    if (isAdminPage) {
                        window.location.href = loginUrl;
                    }
                }
            })
            .catch(function(err) {
                console.error("Superuser ping failed:", err);
                if (isAdminPage) {
                    window.location.href = loginUrl;
                }
            });
        } else {
            // No superuser token exists.
            if (isAdminPage) {
                window.location.href = loginUrl;
            }
        }
    })();
  </script>

  <!-- Títol de la pàgina -->
  <meta property="og:title" content="{{ site.og[current_lang].title }}" />

  <!-- Descripció del contingut -->
  <meta property="og:description" content="{{ site.og[current_lang].title }}" />

  <!-- URL de la pàgina web -->
  <meta property="og:url" content="https://audiovook.com" />

  <!-- Tipus de contingut -->
  <meta property="og:type" content="website" />

  <!-- Imatge representativa (ajusta la URL a la teva imatge) -->
  <meta property="og:image" content="https://audiovook.com/img/og-image.jpg" />

  <!-- Nom del lloc -->
  <meta property="og:site_name" content="Audiovook" />

  <!-- Localització (codi de la llengua, per exemple, català) -->
  <meta property="og:locale" content="ca_ES" />

</head>
