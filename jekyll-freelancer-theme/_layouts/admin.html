<!DOCTYPE html>
<html>
{% include head.html %}
<body id="page-top" class="index">
  {% include nav.html %}
  <section>
    <div class="container">
      {{ content }}
    </div>
  </section>
  {% include footer.html %}
  {% include modals.html %}
  {% include js.html %}
  <script>
    (function() {
      var token = localStorage.getItem('token');
      var lang = '{{ page.lang | default: "ca" }}';
      var loginUrl = '/' + lang + '/login.html';

      if (!token) {
        window.location.href = loginUrl;
        return;
      }

      fetch('http://localhost:8000/api/v1/admin/users/ping', {
        headers: {
          'Authorization': 'Bearer ' + token
        }
      })
      .then(function(response) {
        if (response.status === 401 || response.status === 403) {
          // Unauthorized or Forbidden
          localStorage.removeItem('token'); // Clean up invalid token
          window.location.href = loginUrl;
        } else if (!response.ok) {
          // Other server errors
          console.error('An error occurred while verifying admin access.');
        }
        // If response is ok, do nothing and let the page render.
      })
      .catch(function(error) {
        console.error('Network error while verifying admin access:', error);
      });
    })();
  </script>
</body>
</html>
